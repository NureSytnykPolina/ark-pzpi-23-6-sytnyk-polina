Міністерство освіти і науки України 
Харківський національний університет радіоелектроніки


Кафедра «Програмна інженерія»


ЗВІТ
з лабораторної роботи №3
з дисципліни «Аналіз та рефакторинг коду»




Виконала:	                                                              Прийняв:
ст. гр. ПЗПІ-23-6	                                                      асистент кафедри ПІ
Ситник П.А.	                                                            Дашенков Д.С.










Харків 2025
1. ЗАВДАННЯ
1.	Розробити бізнес логіку серверної частини програмної системи.
2.	Розробити функції адміністрування серверної частини програмної системи.
3.	Створити програмну реалізацію бізнес логіки та функцій адміністрування серверної частини.
4.	Перевірити роботу серверної частини системи.
5.	Завантажити або оновити (при потребі) створений програмний код у GitHub репозиторій для лабораторних робіт у гілку репозиторію main.
6.	Створити відеозапис демонстрації описаної у розділі 3.1 Vision & Scope функціональності серверної частини та завантажити цей відеозапис у свій канал на YouTube для облікового запису в домені @nure.ua.  При завантаженні відеозапису потрібно обовʼязково встановити у налаштуваннях для цього відео українську мову як мову відео та мову субтитрів до відео.
7.	Створити хронологічний опис (хвилина:секунда) демонстрації та додати цей опис до опису відео.
8.	Створити звіт до лабораторної роботи.
9.	Експортувати створений звіт у формат PDF та завантажити його на платформу dl.nure.ua.
10.	Експортувати увесь створений звіт у простий текстовий файл з кодуванням UTF-8 та записати цей файл у GitHub репозиторій для лабораторних робіт з вказаним у цих методичних вказівках іменем файла та директорії.

2. ХІД ВИКОНАННЯ РОБОТИ
2.1 Текстовий опис інженерних рішень
Серверна частина програмної системи Click&Rent реалізована з використанням платформи .NET 8 та фреймворку ASP.NET Core Web API. Даний технологічний стек було обрано через його високу продуктивність, підтримку сучасних архітектурних підходів та зручну інтеграцію з ORM Entity Framework Core.
Для зберігання даних використовується реляційна база даних SQL Server, доступ до якої здійснюється за допомогою Entity Framework Core.
Архітектура системи побудована за принципом багатошарової (Layered Architecture):
•	Controller Layer — обробка HTTP-запитів та повернення відповідей клієнту;
•	Service Layer — реалізація бізнес-логіки та правил обробки даних;
•	Data Layer (DbContext) — взаємодія з базою даних.
Такий підхід забезпечує розділення відповідальностей, підвищує читабельність коду та спрощує його масштабування.

2.2 Програмна реалізація бізнес-логіки
Ключовим бізнес-процесом системи Click&Rent є оформлення оренди одягу. Для цього було створено клас RentService, який інкапсулює всі правила створення оренди.
Алгоритм створення оренди:
1.	Валідація дат оренди (дата початку повинна бути меншою за дату завершення).
2.	Перевірка існування клієнта в системі.
3.	Перевірка існування обраного одягу.
4.	Перевірка доступності одягу на заданий період (відсутність перетину з іншими орендами).
5.	Автоматичний розрахунок вартості оренди на основі кількості днів та ціни за день.
6.	Створення нового запису оренди та збереження його в базі даних.
Фрагмент коду класу RentService:
public async Task<Rent> CreateRentAsync(int clientId, int wearId, DateTime startDate, DateTime endDate)
{
    if (startDate >= endDate)
        throw new ArgumentException("Start_date must be before end_date");

    bool clientExists = await _db.Clients.AnyAsync(c => c.client_id == clientId);
    if (!clientExists)
        throw new Exception("Client not found");

    var wear = await _db.Wears.FirstOrDefaultAsync(w => w.wear_id == wearId);
    if (wear == null)
        throw new Exception("Wear not found");

    bool isBusy = await _db.Rents.AnyAsync(r =>
        r.wear_id == wearId &&
        r.start_date < endDate &&
        startDate < r.end_date);

    if (isBusy)
        throw new Exception("Wear is already rented for this period");

    int days = (endDate - startDate).Days;
    int totalPrice = days * wear.price;

    var rent = new Rent
    {
        client_id = clientId,
        wear_id = wearId,
        start_date = startDate,
        end_date = endDate,
        rent_price = totalPrice,
        rent_pay = totalPrice
    };

    _db.Rents.Add(rent);
    await _db.SaveChangesAsync();

    return rent;
}

2.3 Програмна реалізація функцій адміністрування
Для адміністрування системи було реалізовано сервіс AdminService, який надає розширені можливості керування системою.
Реалізовані функції адміністрування:
•	отримання статистики системи (Dashboard);
•	примусове завершення оренди.
Фрагмент коду класу AdminService:
public async Task<object> GetSystemStatisticsAsync()
{
    return new
    {
        total_clients = await _db.Clients.CountAsync(),
        total_wears = await _db.Wears.CountAsync(),
        total_rents = await _db.Rents.CountAsync()
    };
}

public async Task ForceCloseRentAsync(int rentId)
{
    var rent = await _db.Rents.FirstOrDefaultAsync(r => r.rent_id == rentId);
    if (rent == null)
        throw new Exception("Rent not found");

    rent.end_date = DateTime.Now;
    await _db.SaveChangesAsync();
}
Доступ до бізнес-логіки здійснюється через відповідні API-контролери.

2.4 Перевірка роботи серверної частини
Тестування проводилося за допомогою Swagger UI 
Тестування 1: Створення оренди
•	Метод: POST
•	URL: /api/rents-business/create-with-check
•	Результат: Сервер повернув статус 200 OK, оренду створено, вартість розрахована автоматично.
Тестування 2: Перевірка доступності
•	Результат: При спробі оренди зайнятого одягу сервер повертає помилку, що підтверджує коректність бізнес-логіки.
Тестування 3: Dashboard адміністратора
•	Метод: GET
•	URL: /api/admin/stats
•	Результат: Отримано актуальні статистичні дані системи.

Посилання на GitHub:  https://github.com/NureSytnykPolina/Click-Rent/tree/master/Click%26Rent
Посилання на відеозапис:  https://youtu.be/hV81KG_iYyU
Хронологічний опис відеозапису:
Бізнес логіка - 00:15 
Admin Services - 1:05 
Admin Controllers - 1:28 
Тестування - 1:42

